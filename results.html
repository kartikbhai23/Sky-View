<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weather Details - SkyView</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: white;
      padding: 20px;
      transition: background 1s ease;
    }

    /* Weather-based backgrounds - Day */
    body.clear-weather.day {
      background: linear-gradient(135deg, #2980b9, #6dd5fa, #ffffff);
    }

    body.rain-weather.day {
      background: linear-gradient(135deg, #434343 0%, #757575 100%);
    }

    body.clouds-weather.day {
      background: linear-gradient(135deg, #bdc3c7, #2c3e50);
    }

    body.snow-weather.day {
      background: linear-gradient(135deg, #e6dada, #274046);
    }

    body.thunderstorm-weather.day {
      background: linear-gradient(135deg, #2c3e50, #3498db);
    }

    /* Weather-based backgrounds - Night */
    body.clear-weather.night {
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    }

    body.rain-weather.night {
      background: linear-gradient(135deg, #000000 0%, #434343 100%);
    }

    body.clouds-weather.night {
      background: linear-gradient(135deg, #232526, #414345);
    }

    body.snow-weather.night {
      background: linear-gradient(135deg, #283048, #859398);
    }

    body.thunderstorm-weather.night {
      background: linear-gradient(135deg, #000000, #434343);
    }

    /* Afternoon */
    body.clear-weather.afternoon {
      background: linear-gradient(135deg, #f2994a, #f2c94c, #87ceeb);
    }

    body.rain-weather.afternoon {
      background: linear-gradient(135deg, #636363 0%, #a0a0a0 100%);
    }

    body.clouds-weather.afternoon {
      background: linear-gradient(135deg, #ada996, #f2f2f2);
    }

    body.snow-weather.afternoon {
      background: linear-gradient(135deg, #d4d4d4, #536976);
    }

    body.thunderstorm-weather.afternoon {
      background: linear-gradient(135deg, #373b44, #4286f4);
    }

    /* Weather Effects */
    #clear-sky-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
      opacity: 0;
      transition: opacity 1s ease;
    }

    #clear-sky-container.active {
      opacity: 1;
    }

    .moon {
      position: absolute;
      top: 50px;
      right: 50px;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, #f4f4f4, #d3d3d3);
      border-radius: 50%;
      box-shadow: 0 0 40px 10px rgba(255, 255, 255, 0.4);
      animation: pulse 3s infinite ease-in-out;
    }

    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 0 3px white;
      animation: twinkle 2s infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.9; }
    }

    .sun {
      position: absolute;
      top: 50px;
      right: 50px;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, #fff76a, #fcd440);
      border-radius: 50%;
      box-shadow: 0 0 40px 10px rgba(255, 223, 0, 0.6);
      animation: pulse 3s infinite ease-in-out;
    }

    .cloud {
      position: absolute;
      background: #fff;
      border-radius: 50%;
      opacity: 0.6;
      animation: moveClouds 60s linear infinite;
    }

    .cloud::before,
    .cloud::after {
      content: '';
      position: absolute;
      background: #fff;
      border-radius: 50%;
    }

    .cloud::before {
      width: 60px;
      height: 60px;
      top: -30px;
      left: 30px;
    }

    .cloud::after {
      width: 50px;
      height: 50px;
      top: -20px;
      left: -30px;
    }

    .cloud1 {
      width: 100px;
      height: 60px;
      top: 100px;
      left: -200px;
    }

    .cloud2 {
      width: 120px;
      height: 70px;
      top: 200px;
      left: -300px;
      animation-delay: -20s;
    }

    .cloud3 {
      width: 90px;
      height: 50px;
      top: 300px;
      left: -150px;
      animation-delay: -40s;
    }

    @keyframes moveClouds {
      0% { transform: translateX(0); }
      100% { transform: translateX(calc(100vw + 300px)); }
    }

    #rain-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      opacity: 0;
      transition: opacity 1s ease;
    }

    #rain-container.active {
      opacity: 1;
    }

    .raindrop {
      position: absolute;
      width: 2px;
      height: 50px;
      background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, 0.6));
      animation: fall linear infinite;
    }

    @keyframes fall {
      to {
        transform: translateY(100vh);
      }
    }

    #snow-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      opacity: 0;
      transition: opacity 1s ease;
    }

    #snow-container.active {
      opacity: 1;
    }

    .snowflake {
      position: absolute;
      color: white;
      font-size: 1em;
      animation: snowfall linear infinite;
    }

    @keyframes snowfall {
      to {
        transform: translateY(100vh) rotate(360deg);
      }
    }

    #lightning-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      opacity: 0;
      transition: opacity 1s ease;
    }

    #lightning-container.active {
      opacity: 1;
    }

    .lightning {
      position: absolute;
      width: 100%;
      height: 100%;
      background: white;
      opacity: 0;
    }

    @keyframes flash {
      0%, 100% { opacity: 0; }
      10% { opacity: 0.8; }
      20% { opacity: 0; }
      30% { opacity: 0.9; }
      40% { opacity: 0; }
    }

    .container {
      position: relative;
      z-index: 2;
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      animation: fadeInDown 0.8s ease;
    }

    .header h1 {
      font-size: 48px;
      margin-bottom: 10px;
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .back-btn {
      display: inline-block;
      padding: 12px 30px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50px;
      color: white;
      text-decoration: none;
      font-weight: 600;
      margin-top: 20px;
      transition: all 0.3s;
    }

    .back-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .main-weather {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border-radius: 30px;
      padding: 40px;
      margin-bottom: 30px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      animation: fadeInUp 0.8s ease;
    }

    .location-info {
      text-align: center;
      margin-bottom: 30px;
    }

    .location-info h2 {
      font-size: 42px;
      margin-bottom: 5px;
    }

    .location-info .country {
      font-size: 24px;
      opacity: 0.8;
    }

    .location-info .current-time {
      margin-top: 10px;
      font-size: 16px;
      opacity: 0.8;
    }

    .location-info .coordinates {
      margin-top: 5px;
      font-size: 14px;
      opacity: 0.7;
    }

    .current-weather {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 40px;
      align-items: center;
    }

    .weather-icon-section {
      text-align: center;
    }

    .weather-icon-section .icon {
      font-size: 120px;
      filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.3));
    }

    .weather-icon-section .description {
      font-size: 24px;
      text-transform: capitalize;
      margin-top: 10px;
    }

    .weather-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    .stat-box {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
    }

    .stat-box .label {
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 8px;
    }

    .stat-box .value {
      font-size: 32px;
      font-weight: bold;
    }

    .additional-info {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border-radius: 30px;
      padding: 40px;
      margin-bottom: 30px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      animation: fadeInUp 0.8s ease 0.1s backwards;
    }

    .additional-info h3 {
      font-size: 28px;
      margin-bottom: 25px;
      text-align: center;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .info-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
    }

    .info-card .icon {
      font-size: 36px;
      margin-bottom: 10px;
    }

    .info-card .label {
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 8px;
    }

    .info-card .value {
      font-size: 24px;
      font-weight: bold;
    }

    .today-forecast {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border-radius: 30px;
      padding: 40px;
      margin-bottom: 30px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      animation: fadeInUp 0.8s ease 0.2s backwards;
    }

    .today-forecast h3 {
      font-size: 28px;
      margin-bottom: 25px;
      text-align: center;
    }

    .hourly-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }

    .hour-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      transition: all 0.3s;
    }

    .hour-card:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-5px);
    }

    .hour-card .time {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .hour-card .icon {
      font-size: 40px;
      margin: 10px 0;
    }

    .hour-card .temp {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .hour-card .details {
      font-size: 12px;
      opacity: 0.8;
    }

    .week-forecast {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border-radius: 30px;
      padding: 40px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      animation: fadeInUp 0.8s ease 0.4s backwards;
    }

    .week-forecast h3 {
      font-size: 28px;
      margin-bottom: 25px;
      text-align: center;
    }

    .day-grid {
      display: grid;
      gap: 15px;
    }

    .day-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 25px;
      border-radius: 15px;
      display: grid;
      grid-template-columns: 1fr 1fr 2fr 1fr;
      align-items: center;
      gap: 20px;
      transition: all 0.3s;
    }

    .day-card:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateX(10px);
    }

    .day-card .date {
      font-size: 18px;
      font-weight: 600;
    }

    .day-card .icon {
      font-size: 48px;
      text-align: center;
    }

    .day-card .description {
      text-transform: capitalize;
    }

    .day-card .temp-range {
      text-align: right;
      font-size: 20px;
      font-weight: bold;
    }

    .day-card .max {
      color: #ffeb3b;
    }

    .day-card .min {
      opacity: 0.7;
    }

    .loading {
      text-align: center;
      padding: 100px 20px;
      font-size: 24px;
    }

    .loading::after {
      content: '...';
      animation: dots 1.5s infinite;
    }

    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }

    .error {
      text-align: center;
      padding: 100px 20px;
    }

    .error h2 {
      font-size: 48px;
      margin-bottom: 20px;
    }

    .error p {
      font-size: 20px;
      margin-bottom: 30px;
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 768px) {

      /* Add/modify the existing @media (max-width: 768px) section */

.header h1 {
  font-size: 32px; /* Currently 48px */
}

.main-weather {
  padding: 25px; /* Currently 40px */
}

.location-info h2 {
  font-size: 32px; /* Currently 42px */
}

.current-weather {
  grid-template-columns: 1fr; /* Already present ✓ */
  gap: 25px;
}

.weather-stats {
  grid-template-columns: repeat(2, 1fr); /* Already present ✓ */
  gap: 12px;
}

.additional-info,
.today-forecast,
.week-forecast {
  padding: 25px; /* Currently 40px */
}

.hourly-grid {
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); /* Already present ✓ */
}

.day-card {
  grid-template-columns: 1fr; /* Already present ✓ */
  padding: 20px;
  gap: 12px;
}

/* Add new smaller breakpoint */
@media (max-width: 480px) {
  .weather-stats {
    grid-template-columns: 1fr; /* Single column */
  }
  
  .stat-box .value {
    font-size: 24px; /* Reduce from 32px */
  }
  
  .info-grid {
    grid-template-columns: 1fr; /* Single column */
  }
}

      .current-weather {
        grid-template-columns: 1fr;
      }

      .weather-stats {
        grid-template-columns: repeat(2, 1fr);
      }

      .hourly-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }

      .day-card {
        grid-template-columns: 1fr;
        text-align: center;
      }

      .day-card .temp-range {
        text-align: center;
      }

      .info-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- Weather Effects -->
  <div id="clear-sky-container"></div>
  <div id="rain-container"></div>
  <div id="snow-container"></div>
  <div id="lightning-container">
    <div class="lightning"></div>
  </div>

  <div class="container">
    <div class="header">
      <h1>☀️ Full Weather Details</h1>
      <a href="javascript:window.close();" class="back-btn">← Close Window</a>
    </div>

    <div id="weather-content">
      <div class="loading">Loading detailed weather data</div>
    </div>
  </div>

  <script>
    const API_KEY = 'b0207d006cd00a18ed7b73c87a8772b9';
    const CURRENT_API = 'https://api.openweathermap.org/data/2.5/weather';
    const FORECAST_API = 'https://api.openweathermap.org/data/2.5/forecast';

    const clearSkyContainer = document.getElementById('clear-sky-container');
    const rainContainer = document.getElementById('rain-container');
    const snowContainer = document.getElementById('snow-container');
    const lightningContainer = document.getElementById('lightning-container');

    function getTimeOfDay(timezoneOffset) {
      const now = new Date();
      const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
      const localTime = new Date(utc + (1000 * timezoneOffset));
      const hours = localTime.getHours();

      if (hours >= 5 && hours < 12) return 'day';
      if (hours >= 12 && hours < 17) return 'afternoon';
      return 'night';
    }

    function updateCelestialBody(timeOfDay) {
      clearSkyContainer.innerHTML = '';
      
      if (timeOfDay === 'night') {
        const moon = document.createElement('div');
        moon.className = 'moon';
        clearSkyContainer.appendChild(moon);
        
        for (let i = 0; i < 50; i++) {
          const star = document.createElement('div');
          star.className = 'star';
          star.style.left = Math.random() * 100 + '%';
          star.style.top = Math.random() * 100 + '%';
          star.style.animationDelay = Math.random() * 2 + 's';
          clearSkyContainer.appendChild(star);
        }
      } else {
        const sun = document.createElement('div');
        sun.className = 'sun';
        clearSkyContainer.appendChild(sun);
      }
      
      const cloud1 = document.createElement('div');
      cloud1.className = 'cloud cloud1';
      const cloud2 = document.createElement('div');
      cloud2.className = 'cloud cloud2';
      const cloud3 = document.createElement('div');
      cloud3.className = 'cloud cloud3';
      
      clearSkyContainer.appendChild(cloud1);
      clearSkyContainer.appendChild(cloud2);
      clearSkyContainer.appendChild(cloud3);
    }

    function applyWeatherEffects(weatherMain, timeOfDay) {
      document.body.className = '';
      clearSkyContainer.classList.remove('active');
      rainContainer.classList.remove('active');
      snowContainer.classList.remove('active');
      lightningContainer.classList.remove('active');

      rainContainer.innerHTML = '';
      snowContainer.innerHTML = '';

      updateCelestialBody(timeOfDay);
      document.body.classList.add(timeOfDay);

      switch(weatherMain.toLowerCase()) {
        case 'clear':
          document.body.classList.add('clear-weather');
          clearSkyContainer.classList.add('active');
          break;
        case 'rain':
        case 'drizzle':
          document.body.classList.add('rain-weather');
          rainContainer.classList.add('active');
          createRain();
          break;
        case 'thunderstorm':
          document.body.classList.add('thunderstorm-weather');
          rainContainer.classList.add('active');
          lightningContainer.classList.add('active');
          createRain();
          createLightning();
          break;
        case 'snow':
          document.body.classList.add('snow-weather');
          snowContainer.classList.add('active');
          createSnow();
          break;
        case 'clouds':
          document.body.classList.add('clouds-weather');
          clearSkyContainer.classList.add('active');
          break;
        default:
          document.body.classList.add('clear-weather');
      }
    }

    function createRain() {
      for (let i = 0; i < 100; i++) {
        const drop = document.createElement('div');
        drop.className = 'raindrop';
        drop.style.left = Math.random() * 100 + '%';
        drop.style.animationDuration = (Math.random() * 0.5 + 0.5) + 's';
        drop.style.animationDelay = Math.random() * 2 + 's';
        rainContainer.appendChild(drop);
      }
    }

    function createSnow() {
      for (let i = 0; i < 50; i++) {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.textContent = '❄';
        snowflake.style.left = Math.random() * 100 + '%';
        snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
        snowflake.style.animationDelay = Math.random() * 2 + 's';
        snowflake.style.fontSize = (Math.random() * 10 + 10) + 'px';
        snowContainer.appendChild(snowflake);
      }
    }

    function createLightning() {
      const lightning = lightningContainer.querySelector('.lightning');
      setInterval(() => {
        if (Math.random() > 0.7) {
          lightning.style.animation = 'flash 1s';
          setTimeout(() => {
            lightning.style.animation = '';
          }, 1000);
        }
      }, 3000);
    }

    function getWeatherIcon(main, timeOfDay = 'day') {
      const isNight = timeOfDay === 'night';
      const icons = {
        'Clear': isNight ? '🌙' : '☀️',
        'Clouds': '☁️',
        'Rain': '🌧️',
        'Drizzle': '🌦️',
        'Thunderstorm': '⛈️',
        'Snow': '❄️',
        'Mist': '🌫️',
        'Smoke': '🌫️',
        'Haze': '🌫️',
        'Dust': '🌫️',
        'Fog': '🌫️'
      };
      return icons[main] || '🌤️';
    }

    function formatDate(timestamp) {
      const date = new Date(timestamp * 1000);
      return date.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
    }

    function formatTime(timestamp) {
      const date = new Date(timestamp * 1000);
      return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    }

    function getCurrentLocalTime(timezoneOffset) {
      const now = new Date();
      const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
      const localTime = new Date(utc + (1000 * timezoneOffset));
      return localTime.toLocaleString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric', 
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit'
      });
    }

    function formatSunTime(timestamp, timezoneOffset) {
      const date = new Date((timestamp + timezoneOffset) * 1000);
      return date.toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit',
        timeZone: 'UTC'
      });
    }

    function getWindDirection(degrees) {
      const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
      const index = Math.round(degrees / 22.5) % 16;
      return directions[index];
    }

    function process7DayForecast(forecastData) {
      const dailyData = {};
      
      forecastData.list.forEach(item => {
        const date = new Date(item.dt * 1000).toDateString();
        
        if (!dailyData[date]) {
          dailyData[date] = {
            temps: [],
            weather: item.weather[0],
            date: item.dt
          };
        }
        
        dailyData[date].temps.push(item.main.temp);
      });

      return Object.values(dailyData).slice(0, 7).map(day => ({
        date: day.date,
        weather: day.weather,
        maxTemp: Math.round(Math.max(...day.temps)),
        minTemp: Math.round(Math.min(...day.temps))
      }));
    }

    function displayWeather(currentData, forecastData) {
      const timeOfDay = getTimeOfDay(currentData.timezone);
      const localTime = getCurrentLocalTime(currentData.timezone);
      const todayForecast = forecastData.list.slice(0, 8);
      const weekForecast = process7DayForecast(forecastData);

      applyWeatherEffects(currentData.weather[0].main, timeOfDay);

      const html = `
        <div class="main-weather">
          <div class="location-info">
            <h2>${currentData.name}</h2>
            <div class="country">${currentData.sys.country}</div>
            <div class="current-time">${localTime}</div>
            <div class="coordinates">📍 Lat: ${currentData.coord.lat.toFixed(2)}°, Lon: ${currentData.coord.lon.toFixed(2)}°</div>
          </div>

          <div class="current-weather">
            <div class="weather-icon-section">
              <div class="icon">${getWeatherIcon(currentData.weather[0].main, timeOfDay)}</div>
              <div class="description">${currentData.weather[0].description}</div>
            </div>

            <div class="weather-stats">
              <div class="stat-box">
                <div class="label">Temperature</div>
                <div class="value">${Math.round(currentData.main.temp)}°C</div>
              </div>
              <div class="stat-box">
                <div class="label">Feels Like</div>
                <div class="value">${Math.round(currentData.main.feels_like)}°C</div>
              </div>
              <div class="stat-box">
                <div class="label">Min Temp</div>
                <div class="value">${Math.round(currentData.main.temp_min)}°C</div>
              </div>
              <div class="stat-box">
                <div class="label">Max Temp</div>
                <div class="value">${Math.round(currentData.main.temp_max)}°C</div>
              </div>
              <div class="stat-box">
                <div class="label">Cloudiness</div>
                <div class="value">${currentData.clouds.all}%</div>
              </div>
              <div class="stat-box">
                <div class="label">Humidity</div>
                <div class="value">${currentData.main.humidity}%</div>
              </div>
              <div class="stat-box">
                <div class="label">Wind Speed</div>
                <div class="value">${currentData.wind.speed} m/s</div>
              </div>
              <div class="stat-box">
                <div class="label">Wind Direction</div>
                <div class="value">${getWindDirection(currentData.wind.deg)} ${currentData.wind.deg}°</div>
              </div>
              <div class="stat-box">
                <div class="label">Pressure</div>
                <div class="value">${currentData.main.pressure} hPa</div>
              </div>
            </div>
          </div>
        </div>

        <div class="additional-info">
          <h3>🔍 Additional Information</h3>
          <div class="info-grid">
            <div class="info-card">
              <div class="icon">🌅</div>
              <div class="label">Sunrise</div>
              <div class="value">${formatSunTime(currentData.sys.sunrise, currentData.timezone)}</div>
            </div>
            <div class="info-card">
              <div class="icon">🌇</div>
              <div class="label">Sunset</div>
              <div class="value">${formatSunTime(currentData.sys.sunset, currentData.timezone)}</div>
            </div>
            <div class="info-card">
              <div class="icon">👁️</div>
              <div class="label">Visibility</div>
              <div class="value">${currentData.visibility ? (currentData.visibility / 1000).toFixed(1) + ' km' : 'N/A'}</div>
            </div>
            <div class="info-card">
              <div class="icon">💨</div>
              <div class="label">Wind Gust</div>
              <div class="value">${currentData.wind.gust ? currentData.wind.gust.toFixed(1) + ' m/s' : 'N/A'}</div>
            </div>
            <div class="info-card">
              <div class="icon">🌡️</div>
              <div class="label">Sea Level Pressure</div>
              <div class="value">${currentData.main.sea_level || currentData.main.pressure} hPa</div>
            </div>
            <div class="info-card">
              <div class="icon">⛰️</div>
              <div class="label">Ground Level Pressure</div>
              <div class="value">${currentData.main.grnd_level || currentData.main.pressure} hPa</div>
            </div>
          </div>
        </div>

        <div class="today-forecast">
          <h3>📅 Today's Forecast </h3>
          <div class="hourly-grid">
            ${todayForecast.map(hour => `
              <div class="hour-card">
                <div class="time">${formatTime(hour.dt)}</div>
                <div class="icon">${getWeatherIcon(hour.weather[0].main)}</div>
                <div class="temp">${Math.round(hour.main.temp)}°C</div>
                <div class="details">
                  ☁️ ${hour.clouds.all}%<br>
                  💧 ${hour.main.humidity}%<br>
                  💨 ${hour.wind.speed} m/s
                </div>
              </div>
            `).join('')}
          </div>
        </div>

        <div class="week-forecast">
          <h3>📆 7-Day Forecast</h3>
          <div class="day-grid">
            ${weekForecast.map((day, index) => `
              <div class="day-card">
                <div class="date">${index === 0 ? 'Today' : formatDate(day.date)}</div>
                <div class="icon">${getWeatherIcon(day.weather.main)}</div>
                <div class="description">${day.weather.description}</div>
                <div class="temp-range">
                  <span class="max">${day.maxTemp}°</span> / <span class="min">${day.minTemp}°</span>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;

      document.getElementById('weather-content').innerHTML = html;
    }

    function showError(message = 'Unable to load weather data') {
      document.getElementById('weather-content').innerHTML = `
        <div class="error">
          <h2>❌</h2>
          <p>${message}</p>
          <a href="javascript:window.close();" class="back-btn">Close Window</a>
        </div>
      `;
    }

    async function fetchWeatherData(city) {
      try {
        const currentResponse = await fetch(`${CURRENT_API}?q=${city}&appid=${API_KEY}&units=metric`);
        if (!currentResponse.ok) throw new Error('City not found');
        const currentData = await currentResponse.json();

        const forecastResponse = await fetch(`${FORECAST_API}?q=${city}&appid=${API_KEY}&units=metric`);
        if (!forecastResponse.ok) throw new Error('Forecast not available');
        const forecastData = await forecastResponse.json();

        displayWeather(currentData, forecastData);
      } catch (error) {
        showError(error.message);
      }
    }

    const urlParams = new URLSearchParams(window.location.search);
    const city = urlParams.get('city');

    if (city) {
      fetchWeatherData(city);
    } else {
      showError('No city specified');
    }
  </script>
</body>
</html>